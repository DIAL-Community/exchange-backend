version: '3.7'
services:
 postgres:
  environment:
    POSTGRES_USER: registry
    POSTGRES_PASSWORD: Password!1
    POSTGRES_DB: registry_production
  image: postgres
  volumes:
    - ./postgres-data:/var/lib/postgresql/data
  ports:
    - 5432:5432
 web:
  build:
    context: .
    target: build-web
  environment:
    - SECRET_KEY_BASE=5875385139d569da415070f64a3f38b5a183163c700ff157d7854d9d8b8ca2c59ac4b9b6cc3b96938b43f798e4778712cb887f8ac9a1b5cba0aab3fa871fd92d
    - RAILS_SERVE_STATIC_FILES=true
  entrypoint: /t4d/docker-entrypoint.sh
  command: bundle exec rails s -p 3000 -b '0.0.0.0'
  volumes:
   - .:/t4d
   - ./config/database.yml.docker:/t4d/config/database.yml
  ports:
   - 80:3000
  depends_on:
   - postgres
 
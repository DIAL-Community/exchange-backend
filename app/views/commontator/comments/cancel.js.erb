<% if @comment.nil? || @comment.new_record? %>
  <%
    id = @comment.nil? || @comment.parent.nil? ?
      "commontator-thread-#{@commontator_thread.id}-new-comment" :
      "commontator-comment-#{@comment.parent.id}-reply"
  %>

  $("#<%= id %>").hide();

  $("#<%= id %>-link").fadeIn();
<% else %>
  $("#commontator-comment-<%= @comment.id %>-body").html("<%= escape_javascript(
    render partial: 'body', locals: { comment: @comment }
  ) %>");
<% end %>

$(".wysiwyg-viewer").each(function(index, element) {
  const id = $(element).attr("id")
  const dataId = $(element).attr("body-id");

  let dataBody = $(`#${dataId}`).html();
  if (dataBody) {
    dataBody = dataBody.replace(/&nbsp;/g, ' ');
  }
  
  setViewerForElement(id, dataBody);
});

<%= javascript_proc %>

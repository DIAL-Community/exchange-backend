<div class="card-body">
  <%= form_with(model: contact, local: true) do |form| %>

    <fieldset class="form-label-group">
      <%= form.text_field :name, id: :contact_name, :class => "form-control", :placeholder => "Name" %>
      <%= form.label :name %>
    </fieldset>

    <fieldset class="form-label-group">
      <%= form.text_field :email, id: :contact_email, :class => "form-control", :placeholder => "Email" %>
      <%= form.label :email %>
    </fieldset>

    <fieldset class="form-label-group">
      <%= form.text_field :title, id: :contact_title, :class => "form-control", :placeholder => "Title" %>
      <%= form.label :title %>
    </fieldset>

    <% if !@organization %>
      <fieldset class="form-label-group">
        <input type="text" id="organization-search" class="form-control" placeholder="Search and assign organizations ..." />
        <label for="country-organization">
          Search and assign organizations ...
        </label>
      </fieldset>
    <% end %>

    <div class="card">
    <h6 class="card-header">Assigned Organization</h6>
      <div class="card-body">
        <fieldset id="selected-organizations" class="d-flex flex-wrap">
          <div id="base-selected-organizations" class="card mr-2 mb-2" style="max-width: 20rem;">
            <div class="card-body p-1 d-flex">
              <p class="card-text p-1 m-0" style="flex: 1"></p>
              <% if !@organization %>
                <a class="card-link p-1" onclick="remove(this);">
                  <i class="fas fa-trash-alt" style="color: #6c757d;"></i>
                </a>
              <% end %>
              <input type="hidden"/>
            </div>
          </div>
        </fieldset>
      </div>
    </div>

    <div class="mt-2"></div>
    <% if contact.errors.include?(:duplicate) %>
      <div class="alert alert-warning">
        Another contact with similar name already exists. Press submit again to confirm (or update the form).
        <input type="hidden" name="confirmation" value="true" />
      </div>
    <% end %>

    <fieldset class="float-right">
      <%= form.submit 'Submit', :class => "btn btn-primary" %>
      <%= link_to 'Back', "javascript:window.history.back()", :class => 'btn btn-outline-secondary' %>
    </div>
  <% end %>
</div>

<script>
  <% contact.organizations.sort_by{|organization| organization.name }.each do |organization| %>
    addOrganization('<%= organization.id %>', '<%= organization.name %>');
  <% end %>
</script>
